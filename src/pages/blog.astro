---
import { Image } from "astro:assets"
import type { ImageMetadata } from "astro"

import BaseLayout from "../layouts/BaseLayout.astro"
import Header from "../components/Header.astro"
import LanguageList from "../components/LanguageList.astro"

interface Post {
  title: string
  description: string
  publishDate: string
  tags: string[]
  coverImg: string
}

const posts = await Astro.glob<Post>("./blog/*.md")

const coverImages = posts.map((p) => p.frontmatter.coverImg)

const resolvedImages = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/*.{jpeg,jpg,svg,png,gif}",
)

coverImages.forEach((image) => {
  if (!resolvedImages[image])
    throw new Error(
      `"${image}" does not exist in glob: "src/assets/*.{jpeg,jpg,svg,png,gif}"`,
    )
})
---

<BaseLayout title="Blog â€¢ Bruno Panizzi">
  <Header
    title="Blog"
    description="Um pouco sobre meus projetos e coisas que acho interessante"
  />

  <div class="grid gap-x-4 gap-y-8 sm:grid-cols-2">
    {
      posts.map((post) => (
        <article class="grid gap-y-2 overflow-hidden rounded-md transition-all first-of-type:grid-cols-subgrid hover:bg-zinc-800 hover:shadow-[0_0_0_0.5rem] hover:shadow-zinc-800 sm:first-of-type:col-span-2">
          <div class="relative h-full min-h-36 w-full overflow-hidden rounded-sm">
            <Image
              class="absolute inset-0"
              src={resolvedImages[post.frontmatter.coverImg]()}
              alt={post.frontmatter.title}
            />
          </div>
          <div>
            <header class="flex items-center justify-between gap-2">
              <h3 class="text-xl font-semibold">
                <a href={post.url}>{post.frontmatter.title}</a>
              </h3>
              <p class="text-pretty text-sm text-zinc-300">
                {new Date(post.frontmatter.publishDate).toLocaleDateString()}
              </p>
            </header>
            <div class="my-1">
              <LanguageList langs={post.frontmatter.tags} />
            </div>
            <p class="text-pretty text-zinc-300">
              {post.frontmatter.description}
            </p>
          </div>
        </article>
      ))
    }
  </div>
</BaseLayout>
